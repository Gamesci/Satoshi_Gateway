
# Satoshi Gateway

**Satoshi Gateway** æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å¼€æºä¸”é«˜æ€§èƒ½çš„æ¯”ç‰¹å¸ Stratum æŒ–çŸ¿ç½‘å…³ï¼Œä¸“ä¸º**å®¶åº­çŸ¿å·¥**ï¼ˆHome Minersï¼‰å’Œ**ç‹¬ç«‹æŒ–çŸ¿**ï¼ˆSolo Miningï¼‰è®¾è®¡ã€‚

å®ƒå……å½“æ¯”ç‰¹å¸å…¨èŠ‚ç‚¹ï¼ˆBitcoin Coreï¼‰ä¸çŸ¿æœºä¹‹é—´çš„æ¡¥æ¢ï¼Œé€šè¿‡ Stratum V1 åè®®å°†çŸ¿æœºè¿æ¥åˆ°ä¸»ç½‘ã€‚é¡¹ç›®é‡‡ç”¨ C è¯­è¨€ç¼–å†™ï¼Œæåº¦è½»é‡ï¼Œå®Œç¾æ”¯æŒä»å¾®å‹çŸ¿æœºï¼ˆESP32/NerdMinerï¼‰åˆ°å¤§ç®—åŠ› ASICï¼ˆBitaxe, Whatsminer, Antminerï¼‰çš„å¤šç§è®¾å¤‡ã€‚

> **âš ï¸ é£é™©æç¤º**ï¼šSolo æŒ–çŸ¿æ˜¯ä¸€é¡¹é«˜é£é™©é«˜å›æŠ¥çš„æ´»åŠ¨ã€‚è¯·åŠ¡å¿…ä»”ç»†æ£€æŸ¥ `config.json` ä¸­çš„ `reward_address`ï¼Œè¿™æ˜¯å†³å®šå‡ºå—å¥–åŠ±å½’å±çš„å”¯ä¸€é…ç½®ã€‚å»ºè®®å°†çŸ¿æœºåå°çš„ Worker åç§°ä¹Ÿè®¾ç½®ä¸ºæ‚¨çš„é’±åŒ…åœ°å€ä»¥ä¾¿åŒºåˆ†ï¼Œä½†æœ€ç»ˆæ”¶ç›Šå–å†³äºç½‘å…³é…ç½®ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

* **âš¡ï¸ å¹¿æ³›çš„ç¡¬ä»¶å…¼å®¹æ€§**ï¼š
    * **ASICBoost**: æ”¯æŒ Version Rolling æ‰©å±•ï¼Œå®Œç¾é€‚é… **Bitaxe** ç­‰å¼€æºçŸ¿æœºã€‚
    * **Whatsminer ä¿®æ­£**: å†…ç½®é’ˆå¯¹ç¥é©¬çŸ¿æœºï¼ˆWhatsminerï¼‰çš„ç‰¹æ®Šå…¼å®¹å¤„ç†ï¼Œä¿®å¤äº† Coinbase é•¿åº¦é—®é¢˜ï¼Œç¡®ä¿ç®—åŠ›ä¸æµªè´¹ã€‚
    * **å¤šç‰ˆæœ¬ Coinbase**: æ™ºèƒ½è¯†åˆ« User-Agentï¼Œè‡ªåŠ¨é€‚é…ä¸åŒå‚å•†ï¼ˆStandard, NiceHash, Whatsminerï¼‰çš„åè®®ç»†èŠ‚ã€‚
* **ğŸ“Š å®æ—¶ Web ç›‘æ§é¢æ¿**ï¼š
    * å†…ç½®è½»é‡çº§ HTTP æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£ 8080ï¼‰ã€‚
    * å®æ—¶æŸ¥çœ‹æ€»ç®—åŠ›ã€æ´»è·ƒçŸ¿æœºåˆ—è¡¨ï¼ˆæ˜¾ç¤º User-Agent/å‹å·ï¼‰ã€æœ€è¿‘æäº¤çš„ Share è®°å½•ã€‚
    * å¯è§†åŒ–ç®—åŠ›æ›²çº¿å›¾ã€‚
* **ğŸ›  æ ‡å‡† Stratum V1 åè®®**ï¼šæ”¯æŒæ ‡å‡†çš„æŒ–çŸ¿åè®®ï¼Œå…¼å®¹å¸‚é¢ä¸Šç»å¤§å¤šæ•°çŸ¿æœºã€‚
* **âš–ï¸ VarDiff (åŠ¨æ€éš¾åº¦)**ï¼šè‡ªåŠ¨æ ¹æ®çŸ¿æœºç®—åŠ›è°ƒæ•´éš¾åº¦ï¼Œç¡®ä¿ä» 50KH/s (ESP32) åˆ° 100TH/s (ASIC) çš„è®¾å¤‡å‡å¯ç¨³å®šè¿æ¥ã€‚
* **ğŸš€ ZMQ æé€Ÿå“åº”**ï¼šé€šè¿‡ç›‘å¬ Bitcoin Core çš„ ZMQ æ¥å£ï¼Œæ¯«ç§’çº§æ„ŸçŸ¥æ–°åŒºå—è¯ç”Ÿï¼Œå‡å°‘ç©ºå—ç‡ã€‚
* **ğŸª¶ æç®€æ¶æ„**ï¼šC è¯­è¨€ç¼–å†™ï¼Œä¾èµ–æå°‘ï¼Œé€‚åˆéƒ¨ç½²åœ¨æ ‘è“æ´¾ã€é—²ç½® PC æˆ–äº‘æœåŠ¡å™¨ä¸Šã€‚

## ğŸ”Œ æ”¯æŒçš„ç¡¬ä»¶

Satoshi Gateway ç»è¿‡æµ‹è¯•ï¼Œæ”¯æŒä»¥ä¸‹è®¾å¤‡ï¼š

* **Bitaxe (Ultra/Gamma/Supra)**: åŸºäº BM1366 ç­‰èŠ¯ç‰‡çš„å¼€æº ASIC çŸ¿æœºï¼ˆæ¨èï¼‰ã€‚
* **Whatsminer (ç¥é©¬çŸ¿æœº)**: M20/M30/M50/M60 ç­‰ç³»åˆ—ï¼ˆå·²ä¿®å¤åè®®å…¼å®¹æ€§ï¼‰ã€‚
* **NerdMiner / ESP32**: æ•™å­¦çº§å¾®å‹çŸ¿æœºï¼ˆéœ€è°ƒæ•´éš¾åº¦é…ç½®ï¼‰ã€‚
* **Antminer (èš‚èšçŸ¿æœº)**: S9/S19 ç­‰æ”¯æŒ Stratum V1 çš„æœºå‹ã€‚

## ğŸš€ å®‰è£…ä¸éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker (æ¨è)

å¦‚æœæ‚¨ç†Ÿæ‚‰ Dockerï¼Œè¿™æ˜¯æœ€å¿«å¯åŠ¨çš„æ–¹å¼ã€‚

1.  **æ„å»ºé•œåƒ**ï¼š
    ```bash
    docker build -t satoshi-gateway .
    ```

2.  **å‡†å¤‡é…ç½®æ–‡ä»¶**ï¼š
    åœ¨å½“å‰ç›®å½•åˆ›å»º `config.json` (å‚è€ƒä¸‹æ–‡é…ç½®è¯´æ˜)ã€‚

3.  **è¿è¡Œå®¹å™¨**ï¼š
    ```bash
    docker run -d \
      --name sgw \
      --net=host \
      -v $(pwd)/config.json:/app/config.json \
      -v $(pwd)/backup:/app/backup \
      satoshi-gateway
    ```
    *æ³¨æ„ï¼šä½¿ç”¨ `--net=host` æ˜¯ä¸ºäº†æ–¹ä¾¿è¿æ¥æœ¬åœ° Bitcoin Core çš„ ZMQ å’Œ RPCï¼Œå¹¶æš´éœ² 3333/8080 ç«¯å£ã€‚*

### æ–¹å¼äºŒï¼šæºç ç¼–è¯‘

**ä¾èµ–é¡¹ (Ubuntu/Debian):**
```bash
sudo apt-get update
sudo apt-get install -y build-essential cmake libcurl4-openssl-dev libjansson-dev libzmq3-dev git pkg-config

```

**ç¼–è¯‘æ­¥éª¤:**

```bash
# 1. å…‹éš†ä»£ç 
git clone [https://github.com/your-repo/satoshi_gateway.git](https://github.com/your-repo/satoshi_gateway.git)
cd satoshi_gateway

# 2. ç¼–è¯‘
mkdir build && cd build
cmake ..
make -j$(nproc)

# 3. è¿è¡Œ
./satoshi_gateway -c ../config.json

```

## âš™ï¸ é…ç½®è¯´æ˜

åœ¨è¿è¡Œä¹‹å‰ï¼Œè¯·å¤åˆ¶å¹¶ä¿®æ”¹ `config.json`ï¼š

```json
{
  "rpc_url": "[http://127.0.0.1:8332](http://127.0.0.1:8332)",    // æ¯”ç‰¹å¸èŠ‚ç‚¹çš„ RPC åœ°å€
  "rpc_user": "your_rpc_user",           // RPC ç”¨æˆ·å
  "rpc_pass": "your_rpc_password",       // RPC å¯†ç 
  "zmq_pub_hashblock": "tcp://127.0.0.1:28332", // ZMQ ç›‘å¬åœ°å€ (å¿…é¡»ä¸æ¯”ç‰¹å¸èŠ‚ç‚¹ä¸€è‡´)
  
  "reward_address": "bc1q...",           // ã€é‡è¦ã€‘ä½ çš„æ¯”ç‰¹å¸é’±åŒ…åœ°å€ï¼Œç”¨äºæ¥æ”¶æŒ–çŸ¿å¥–åŠ±
  "pool_tag": "/SatoshiGateway/",        // Coinbase ä¸­çš„ä¸ªæ€§åŒ–æ ‡ç­¾
  
  "listen_port": 3333,                   // Stratum æœåŠ¡ç›‘å¬ç«¯å£
  "poll_interval": 30,                   // RPC è½®è¯¢é—´éš” (ç§’)
  
  "diff_asic": 1024,                     // èµ·å§‹éš¾åº¦ (é‡è¦ï¼Œè§ä¸‹æ–‡ç¡¬ä»¶é€‚é…)
  "vardiff_target_shares_min": 6,        // VarDiff ç›®æ ‡æ¯åˆ†é’Ÿæäº¤çš„ Share æ•°é‡
  "extranonce2_size": 8,                 // ExtraNonce2 é•¿åº¦
  "version_mask": "1fffe000"             // ASICBoost Version Rolling Mask
}

```

### é’ˆå¯¹ä¸åŒç¡¬ä»¶çš„é…ç½®å»ºè®® (`diff_asic`)

* **Bitaxe / Whatsminer / Antminer**:
* æ¨èè®¾ç½®: **1024** æˆ–æ›´é«˜ (å¦‚ 4096)ã€‚
* è¯´æ˜: ASIC ç®—åŠ›è¾ƒå¼ºï¼Œé«˜èµ·å§‹éš¾åº¦å¯å‡å°‘æ¡æ‰‹åˆæœŸçš„ç½‘ç»œæµé‡ã€‚


* **NerdMiner (ESP32)**:
* **å¿…é¡»è®¾ç½®**: **1** (æˆ– 0.5)ã€‚
* è¯´æ˜: ESP32 ç®—åŠ›æä½ï¼ˆ~50KH/sï¼‰ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤ 1024 éš¾åº¦ï¼Œå¯èƒ½æ•°å°æ—¶éƒ½æ— æ³•æäº¤ä¸€ä¸ª Shareï¼Œå¯¼è‡´è¿æ¥è¶…æ—¶æ–­å¼€ã€‚



## ğŸ–¥ï¸ Web ç›‘æ§é¢æ¿

å¯åŠ¨ç½‘å…³åï¼Œæ‚¨å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ç›‘æ§é¢æ¿ï¼š

**åœ°å€**: `http://<æœåŠ¡å™¨IP>:8080`

**åŠŸèƒ½**:

* **Active Workers**: æŸ¥çœ‹åœ¨çº¿çŸ¿æœºï¼ŒåŒ…å« IPã€**User-Agent (å‹å·)**ã€å®æ—¶ç®—åŠ›ã€å½“å‰éš¾åº¦ã€‚
* **Network Info**: æŸ¥çœ‹å½“å‰åŒºå—é«˜åº¦ã€å…¨ç½‘éš¾åº¦ã€å‡ºå—å¥–åŠ±ã€‚
* **Recent Shares**: å®æ—¶æ»šåŠ¨çš„ Share æäº¤è®°å½•ï¼ˆåŒ…å«æ˜¯å¦å‘ç°åŒºå—ï¼‰ã€‚
* **Top 3 Best Shares**: æœ¬æ¬¡è¿è¡Œå‘¨æœŸå†…æäº¤çš„æœ€ä½³éš¾åº¦è®°å½•ã€‚

## ğŸ”— å‰ç½®è¦æ±‚ (Bitcoin Core)

ç¡®ä¿æ‚¨çš„ Bitcoin Core èŠ‚ç‚¹ (`bitcoin.conf`) å·²é…ç½®å¦‚ä¸‹ï¼š

```ini
server=1
txindex=1               # æ¨èå¼€å¯ï¼Œä¾¿äºæŸ¥è¯¢
rpcuser=your_user
rpcpassword=your_pass
zmqpubhashblock=tcp://0.0.0.0:28332  # å¿…é¡»å¼€å¯ ZMQ ä»¥ä¾¿ç½‘å…³å¿«é€Ÿå“åº”
rpcallowip=127.0.0.1/0  # å…è®¸ç½‘å…³è¿æ¥ IP

```

## ğŸ“ å¼€å‘è®¡åˆ’ (Roadmap)

* [x] ä¿®å¤ Whatsminer Coinbase é•¿åº¦å…¼å®¹æ€§é—®é¢˜ã€‚
* [x] ä¿®å¤ Web é¢æ¿ JSON åºåˆ—åŒ–å´©æºƒé—®é¢˜ã€‚
* [x] Web é¢æ¿å¢åŠ  User-Agent æ˜¾ç¤ºã€‚
* [ ] å®ç°â€œç©ºå—é€Ÿå‘â€æœºåˆ¶ (Empty Block Fast Send)ã€‚
* [ ] å¢åŠ æ›´å¤šå“ç‰Œ ASIC çš„è‡ªåŠ¨è¯†åˆ«ä¸ä¼˜åŒ–ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](https://www.google.com/search?q=LICENSE) æ–‡ä»¶ã€‚
